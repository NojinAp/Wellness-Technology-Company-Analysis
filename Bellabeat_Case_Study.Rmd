---
title: "How Can a Wellness Technology Company Play It Smart?"
author: "Nozhin Azarpanah"
output:
  pdf_document: default
  html_notebook: default
---

### Scenario
[Bellabeat](https://bellabeat.com/) is a high-tech manufacturer of health-focused products for women. It offers different smart devices that collect data on activity, sleep, stress, and reproductive health to empower women with knowledge about their own health and habits.

Bellabeat offers a range of products, among which is the Bellabeat app. The Bellabeat app provides users with health data related to their activity, sleep, stress, menstrual cycle, and mindfulness habits. This data can help users better understand their current habits and make healthy decisions. The Bellabeat app connects to their line of smart wellness products. Bellabeat is a successful small company, however, Urška Sršen, co-founder and Chief Creative Officer of Bellabeat, believes that it has the potential to become even a larger player in the global smart device market.

In this project, I will present my analysis on the smart devices' fitness data to the Bellabeat executive team along with my high-level recommendations for Bellabeat’s marketing strategy to help unlock new growth opportunities for the company.

___

## 1. Ask Phase


### Business task
Identify potential opportunities for growth and recommendations for the Bellabeat marketing strategy improvement based on the trends in smart device usage.

### Questions to answer
1. What are some trends in smart device usage?
2. How could these trends apply to Bellabeat customers?
3. How could these trends help influence Bellabeat marketing strategy?

### Deliverables
This project will contain the following deliverables:

1. A clear summary of the business task
2. A description of all data sources used
3. Documentation of any cleaning or manipulation of data
4. A summary of your analysis
5. Supporting visualizations and key findings
6. Top high-level content recommendations based on analysis

___

## 2. Prepare Phase


### Source of data: 
The data source used for this case study is [FitBit Fitness Tracker Data](https://www.kaggle.com/datasets/arashnic/fitbit). The data used in this project is stored in Kaggle and was made available through [Mobius](https://www.kaggle.com/arashnic). This Kaggle data set contains personal fitness tracker from thirty Fitbit users.

### Accessibility and privacy of data: 
This data set is open-source. The owner has dedicated the work to the public domain by waiving all of his rights to the work worldwide under copyright law, including all related and neighboring rights, to the extent allowed by law. You can copy, modify, distribute and perform the work, even for commercial purposes, all without asking permission.

### Information about the data set:
This data set was generated by respondents to a distributed survey via Amazon Mechanical Turk between 03/12/2016 and 05/12/2016. Thirty eligible Fitbit users consented to the submission of personal tracker data, including minute-level output for physical activity, heart rate, and sleep monitoring. Variation between output represents use of different types of Fitbit trackers and individual tracking behaviors/preferences.

### Data organization and verification: 
There are 18 .CSV documents in this data set. Each document represents different quantitative data tracked by Fitbit. Every user has a unique ID and different rows since data is tracked by day and time.

### Data credibility and integrity:
Due to the limitation of size (30 users) and not having any demographic information, I could encounter a sampling bias. I am not sure if the sample is representative of the population as a whole. Furthermore, it's important to note that the data set is not current, and there's the additional constraint of the survey being limited to a duration of two months. In light of these considerations, I will adopt an operational approach for our case study.

___

## 3. Process Phase


### Install & load packages

We first install and load the packages we are going to use during this project.
```{r message=FALSE, warning=FALSE, include=FALSE}
install.packages("tidyverse")
install.packages("dplyr")
install.packages("janitor")
install.packages("RColorBrewer")
install.packages("ggplot2")
install.packages("ggpubr")
install.packages("scales")
install.packages("tinytex")
tinytex::install_tinytex()
library("tidyverse")
library("dplyr")
library("janitor")
library("RColorBrewer")
library("ggplot2")
library("ggpubr")
library("scales")
```

### Read the data files and create data frames

Throughout this project, our focus will center around five key files containing users' data on daily activity, calories, intensities, sleep, and steps.
```{r}
daily_activity <- read.csv("~/dataFiles/dailyActivity.csv")
daily_calories <- read.csv("~/dataFiles/dailyCalories.csv")
daily_intensities <- read.csv("~/dataFiles/dailyIntensities.csv")
daily_sleep <- read.csv("~/dataFiles/dailySleep.csv")
daily_steps <- read.csv("~/dataFiles/hourlySteps.csv")
weight_log <- read.csv("~/dataFiles/weightLog.csv")
heart_rate <- read.csv("~/dataFiles/heartRatePerSecond.csv")
```
Here is a summary of the data sets and the first few rows of each:
```{r}
str(daily_activity)
str(daily_calories)
str(daily_intensities)
str(daily_sleep)
str(daily_steps)
str(weight_log)
str(heart_rate)

head(daily_activity)
head(daily_calories)
head(daily_intensities)
head(daily_sleep)
head(daily_steps)
head(weight_log)
head(heart_rate)
```

### Verify the number of users

Let's check out the number of users in each data set:
```{r}
n_distinct(daily_activity$Id)
n_distinct(daily_calories$Id)
n_distinct(daily_intensities$Id)
n_distinct(daily_sleep$Id)
n_distinct(daily_steps$Id)
n_distinct(weight_log$Id)
n_distinct(heart_rate$Id)
```
Considering the limited data available in the weight log and heart rate, we refrain from conducting an analysis on users' weights and heart rate due to the data sets' small size.

### Remove duplicates and nulls

To make sure the data is clean, we inspect each data set for duplicate and null values, removing any instances found.
```{r}
sum(duplicated(daily_activity))
sum(duplicated(daily_calories))
sum(duplicated(daily_intensities))
sum(duplicated(daily_sleep))
sum(duplicated(daily_steps))
```
```{r}
sum(is.na(daily_activity))
sum(is.na(daily_calories))
sum(is.na(daily_intensities))
sum(is.na(daily_sleep))
sum(is.na(daily_steps))
```
```{r}
daily_sleep <- daily_sleep %>%
  distinct() %>%
  drop_na()

sum(duplicated(daily_sleep))
```
We standardize the column names by converting them to lowercase and employ the clean_names() function to ensure uniqueness and consistency across all columns.
```{r}
clean_names(daily_activity)
daily_activity <- rename_with(daily_activity, tolower)

clean_names(daily_calories)
daily_calories <- rename_with(daily_calories, tolower)

clean_names(daily_intensities)
daily_intensities <- rename_with(daily_intensities, tolower)

clean_names(daily_sleep)
daily_sleep <- rename_with(daily_sleep, tolower)

clean_names(daily_steps)
daily_steps <- rename_with(daily_steps, tolower)
```

### Data standardization and type conversion

Additionally, we verify that the column containing the date or time of an activity is consistently labeled as 'date' in each data set, we enhance data integrity by converting the data type of the 'date' column from 'character' ('chr') to 'Date' across all data sets.
```{r}
# Rename columns in daily_activity
daily_activity <- daily_activity %>%
  rename(date = activitydate) %>%
  mutate(date = as.Date(date, format = "%m/%d/%Y"))

# Rename columns in daily_calories
daily_calories <- daily_calories %>%
  rename(date = activityday) %>%
  mutate(date = as.Date(date, format = "%m/%d/%Y"))

# Rename columns in daily_intensities
daily_intensities <- daily_intensities %>%
  rename(date = activityday) %>%
  mutate(date = as.Date(date, format = "%m/%d/%Y"))

# Rename columns in daily_sleep
daily_sleep <- daily_sleep %>%
  rename(date = sleepday) %>%
  mutate(date = as.Date(date, format = "%m/%d/%Y"))

# Rename columns in daily_steps
daily_steps <- daily_steps %>%
  rename(date_time = activityhour) %>% 
  mutate(date_time = as.POSIXct(date_time, format = "%m/%d/%Y %I:%M:%S %p" , tz=Sys.timezone())) %>%
  mutate(time = ifelse(format(date_time, "%H:%M:%S") == "00:00:00", "00:00:00", format(date_time, "%H:%M:%S")),
         date = as.Date(date_time)) %>%
  select(-date_time)
```
Here is a summary of our cleaned data sets:
```{r}
str(daily_activity)
str(daily_calories)
str(daily_intensities)
str(daily_sleep)
str(daily_steps)
```

___

## 4. Analyze and Share Phase

### Statistical summary

Let's start off by getting a statistical summary of the data sets:
```{r}
daily_activity %>%
  select(totaldistance, totalsteps,sedentaryminutes,lightlyactiveminutes, fairlyactiveminutes,veryactiveminutes, sedentaryactivedistance, lightactivedistance, moderatelyactivedistance, veryactivedistance, calories) %>% 
  summary()

daily_sleep %>%
  select(totalminutesasleep, totaltimeinbed) %>% 
  summary()
```
These are key insights drawn from the summarized statistics of the data sets:

**total_distance**:

The minimum distance covered is 0, indicating there are instances where no distance was traveled.
The majority of the data falls below 7.713 units, with a median of 5.245.
The mean distance is slightly higher than the median, suggesting a slightly right-skewed distribution.
The maximum recorded distance is 28.030 units.

**total_steps**:

The number of steps taken ranges from 0 to 36019, with an average of 7638 steps.
The distribution appears positively skewed, with a median of 7406 and a mean higher than the median.

**sedentary_minutes**:

Sedentary minutes range from 0 to 1440, with an average of 991.2 minutes.
The majority of data falls within the first quartile, suggesting a right-skewed distribution.
The maximum value of 1440 indicates instances of the entire day spent sedentary.

**lightly_active_minutes, fairly_active_minutes, very_active_minutes**:

These columns indicate the minutes spent in different activity levels.
There is a wide range of activity levels, with some users having 0 minutes in certain categories.
The maximum values for fairly and very active minutes are 143 and 210, respectively.

**sedentary_active_distance, light_active_distance, moderately_active_distance, very_active_distance**:

These columns represent the distance covered in different activity levels.
Most of the data in sedentary_active_distance is 0, indicating negligible distance covered during sedentary activities.
The maximum values for moderately_active_distance and very_active_distance are 6.48 and 21.92, respectively.

**calories**:

The minimum recorded calories are 0, indicating cases where no calories were burned.
The majority of the data falls between 1828 and 2793 calories.
The mean calorie consumption is 2304, with a median of 2134, indicating a right-skewed distribution.
The maximum recorded calorie consumption is 4900.

**total_minutes_asleep, total_time_in_bed**:

The time spent asleep and in bed varies widely, with a minimum of 58 minutes and a maximum of 796 minutes for total_minutes_asleep
The average time spent asleep is 419.2 minutes, with an average total time in bed of 458.5 minutes.

### User classification by activity level
According to [1000 Steps](https://www.10000steps.org.au/articles/healthy-lifestyles/counting-steps/), the following pedometer indices have been developed to provide a guideline on steps and activity levels:

* Sedentary is less than 5,000 steps per day 
* Low active is 5,000 to 7,499 steps per day
* Somewhat active is 7,500 to 9,999 steps per day
* Active is more than 10,000 steps per day
* Highly active is more than 12,500 

We generate a new data frame that contains the average values for distance covered, calories burned, minutes asleep, and total steps taken by individual users.
```{r}
merged_data <- merge(daily_activity, daily_sleep, by = c("id","date"))

daily_average <- merged_data %>%
  group_by(id) %>%
  summarise(
    mean_daily_distance = mean(totaldistance),
    mean_daily_calories = mean(calories),
    mean_daily_sleep = mean(totalminutesasleep),
    mean_daily_steps = mean(totalsteps)
  )

head(daily_average)
```
We categorize each user based on their average daily number of steps, assigning them a specific user type.

```{r}
user_type <- daily_average %>%
  mutate(user_type = case_when(
    mean_daily_steps < 5000 ~ "Sedentary",
    mean_daily_steps >= 5000 & mean_daily_steps < 7499 ~ "Lightly Active", 
    mean_daily_steps >= 7500 & mean_daily_steps < 9999 ~ "Fairly Active", 
    mean_daily_steps >= 10000 ~ "Very Active"
  ))

head(user_type)
```
To visualize the distribution of user types, we compute the total percentage for each user type and represent it in a pie chart.

```{r}
user_type_percent <- user_type %>%
  group_by(user_type) %>%
  summarise(total = n()) %>%
  mutate(totals = sum(total)) %>%
  group_by(user_type) %>%
  summarise(total_percent = total / totals) %>%
  mutate(labels = percent(total_percent))

head(user_type_percent)
```
```{r}
user_type_percent %>%
  ggplot(aes(x = "", y = total_percent, fill = user_type)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y", start = 0) +
  theme_void() +
  theme(plot.title = element_text(hjust = 0.5, size = 14, face = "bold")) +
  scale_fill_manual(values = brewer.pal(4, "Accent")) +
  geom_text(aes(label = labels), position = position_stack(vjust = 0.5)) +
  labs(title="User Type Distribution") +
  guides(fill = guide_legend(title = "User Type", keywidth = 2, keyheight = 1,))
```
As observed from above, the majority of users can be considered fairly active.

### Correlations

Let's explore the correlation between the duration of sleep and calories burned, as well as the relationship between the number of steps taken and calories burned.

```{r}
ggarrange(
ggplot(merged_data, aes(x = totalminutesasleep, y = calories))+
  geom_jitter() +
  geom_smooth(color = "red") + 
  labs(title = "Time Asleep vs Calories", x = "Minutes of Sleep", y = "Calories") +
   theme(panel.background = element_blank(),
        plot.title = element_text(size = 14)), 
ggplot(merged_data, aes(x = totalsteps, y = calories))+
  geom_jitter() +
  geom_smooth(color = "red") + 
  labs(title = "Steps vs Calories", x = "Number of Steps", y = "Calories") +
   theme(panel.background = element_blank(),
        plot.title = element_text(size = 14)),
ggplot(merged_data, aes(x = totalminutesasleep, y = totaltimeinbed))+
  geom_jitter() +
  geom_smooth(color = "red") + 
  labs(title = "Time Asleep vs Time in Bed", x = "Minutes of Sleep", y = "Minutes in Bed") +
   theme(panel.background = element_blank(),
        plot.title = element_text(size = 14))
)

```
While the data reveals no distinct correlation between calories burned and sleep duration, a positive correlation emerges between the number of steps taken and calories burned. Moreover, the positive correlation between total time asleep and total time in bed suggests that people who spend more time in bed tend to sleep longer.

### Observations of users' daily sleep and activity patterns over the week

Next, we analyze the users' sleep and activity during the week.

```{r}
weekday_steps_sleep <- merged_data %>%
  mutate(weekday = weekdays(date))

weekday_steps_sleep$weekday <- ordered(weekday_steps_sleep$weekday, levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"))

 weekday_steps_sleep <- weekday_steps_sleep %>%
  group_by(weekday) %>%
  summarize (daily_steps = mean(totalsteps), daily_sleep = mean(totalminutesasleep))

head(weekday_steps_sleep)
```
```{r}
ggarrange(
    ggplot(weekday_steps_sleep) +
      geom_col(aes(weekday, daily_steps), fill = "#ECB390") +
      geom_hline(yintercept = 10000) +
      labs(title = "Number of Steps per Weekday", x= "", y = "") +
      theme(axis.text.x = element_text(angle = 45,vjust = 0.5, hjust = 1)),
    ggplot(weekday_steps_sleep, aes(weekday, daily_sleep)) +
      geom_col(fill = "#AA5656") +
      geom_hline(yintercept = 420) +
      labs(title = "Minutes Asleep per Weekday", x = "", y = "") +
      theme(axis.text.x = element_text(angle = 45,vjust = 0.5, hjust = 1))
  )
```
Based on the analysis, it's evident that users exhibit increased activity levels on Saturdays, while Sundays see users getting more sleep. Additionally, users tend to fall short of the recommended daily step count (10,000), but generally achieve the recommended sleep duration of 7 hours or more.

### Observations of users' step patterns throughout the day.

We now delve into the analysis of users' daily step patterns.

```{r}
daily_steps %>%
  group_by(time) %>%
  summarize(average_steps = mean(steptotal)) %>%
  ggplot() +
  geom_col(mapping = aes(x = time, y = average_steps, fill = average_steps)) + 
  labs(title = "Hourly Steps During the Day", x = "Time of Day", y = "Average Steps") + 
  scale_fill_gradient(low = "green", high = "red")+
  guides(fill = guide_legend(title = "User Type"))+
  theme(axis.text.x = element_text(angle = 90))
```
The visualization shows users are most active during the day, peaking at 6:00 PM. Notably, heightened activity is observed from 12:00 PM to 2:00 PM and 5:00 PM to 7:00 PM.

### Observations of users' device utilization

Now that we've observed patterns in activity, sleep, and calorie expenditure, our focus shifts to understanding the frequency of device usage among our sampled users. This exploration is crucial for shaping our marketing strategy and identifying features that enhance smart device utilization.

To quantify usage frequency, we'll categorize our sample based on a 31-day interval:

* High use: Users employing their devices between 21 and 31 days.
* Moderate use: Users utilizing their devices for 10 to 20 days.
* Low use: Users engaging with their devices for 1 to 10 days.
```{r}
daily_use <- merged_data %>%
  group_by(id) %>%
  summarize(days_used = sum(n())) %>%
  mutate(usage = case_when(
    days_used >= 1 & days_used <= 10 ~ "Low Use",
    days_used >= 11 & days_used <= 20 ~ "Moderate Use", 
    days_used >= 21 & days_used <= 31 ~ "High Use", 
  ))
  
head(daily_use)
```

To visually represent the diversity in users' utilization of the smart product, we calculate the overall percentage for each category of usage and illustrate it through a pie chart.
```{r}
daily_use_percent <- daily_use %>%
  group_by(usage) %>%
  summarise(total = n()) %>%
  mutate(totals = sum(total)) %>%
  group_by(usage) %>%
  summarise(total_percent = total / totals) %>%
  mutate(labels = percent(total_percent))

head(daily_use_percent)
```
```{r}
daily_use_percent %>%
  ggplot(aes(x = "",y = total_percent, fill = usage)) +
  geom_bar(stat = "identity", width = 1)+
  coord_polar("y", start = 0)+
  theme_minimal()+
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.border = element_blank(), 
        panel.grid = element_blank(), 
        axis.ticks = element_blank(),
        axis.text.x = element_blank(),
        plot.title = element_text(hjust = 0.5, size = 14, face = "bold")) +
  geom_text(aes(label = labels),
            position = position_stack(vjust = 0.5))+
  scale_fill_brewer(palette = "Blues",
                    labels = c("High use - 21 to 31 days",
                                 "Moderate use - 11 to 20 days",
                                 "Low use - 1 to 10 days"))+
  labs(title = "Users Daily Use of Bellabeat Smart Devices")+
  guides(fill = guide_legend(title = "Usage", keywidth = 2, keyheight = 1,))
```
As shown above, a majority of users exhibit a high level of product engagement, with a notable portion demonstrating moderate use that presents an opportunity for improvement.

### Observations of trends in users' sleep and step habits during this timeframe.

Let's examine whether users have increased or decreased their sleep and activity levels during this period.
```{r}
ggplot(merged_data, aes(x = date)) +
  geom_line(aes(y = totalminutesasleep, color = "Sleep Duration"), linewidth = 1, linetype = "solid") +
  geom_line(aes(y = totalsteps, color = "Daily Steps"), linewidth = 1, linetype = "dashed") + labs(title = "Users' Sleep and Steps Over Time",
       x = "Date",
       y = "Minutes/Steps",
       color = "Metric") +
  theme_minimal() +
  scale_color_manual(values = c("Sleep Duration" = "#4e79a7", "Daily Steps" = "#d73027")) + 
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank(),
        axis.line = element_line(color = "black"),
        legend.position = "top",
        legend.title = element_text(face = "bold", size = 10),
        legend.text = element_text(size = 8),
        plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
        axis.title = element_text(size = 12, face = "bold"),
        axis.text = element_text(size = 10),
        axis.ticks = element_line(color = "black"))
```
Based on the provided line chart depicting users' sleep duration and daily steps over time, it appears that there is no clear or specific trend in the relationship between these two variables. The lines representing sleep duration and daily steps show fluctuations without a consistent upward or downward pattern.

___

## 5. Act Phase
Condsidering the analysis, we can make the following recommendations to help improve Bellabeat marketing strategy:

* Daily Step Notifications:
We categorized users into four groups and found that, on average, users walk over 7,500 steps daily, excluding Sundays. To encourage meeting the CDC (Centers for Disease Control and Prevention)'s recommended daily step goal of 10,000, we propose sending alarms to users falling short and creating app posts highlighting the benefits. CDC states higher step count correlates with lower mortality rates, and we also observed a positive link between steps and calories.

* Sleep Improvement Notifications:
Our data indicates users sleep less than 8 hours daily. To address this, users can set a bedtime and receive pre-sleep notifications. Additionally, we can provide resources such as breathing exercises, calming music podcasts, and sleep techniques to aid in better sleep.

* Reward System for Activity:
Recognizing that not all users respond to notifications, we suggest a time-limited in-app game. Users progress through levels based on daily step counts, requiring consistent activity for rewards. Earned stars can be redeemed for merchandise or discounts on Bellabeat products.

* Product Features Promotion:
Despite our analysis revealing that only 50% of users engage with their device daily, we continue to promote Bellabeat's product features, including water resistance, long-lasting batteries, and fashionable designs suitable for any occasion without battery concerns.
